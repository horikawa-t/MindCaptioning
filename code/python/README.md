## Text generation analysis
- We implemented the text generation analysis using Python.
- Results of feature decoding are required for generating descriptions from the brain.

### Setup instructions
- Run the following command to set up and activate the conda enviroment (named 'mcap_demo').
```plaintext
>> sh ./setup.sh
>> source activate mcap_demo
```
- For Linux: Tested Ubuntu 20.04.6 and 22.04.1 with NVIDIA GPU.
- For Mac: Tested macOS Monterey version 1.12.1.
- For a list of installed library versions on Linux, see [./version_info.txt](./version_info.txt).
- The installation process will take a few minutes.

### Demo
- You can use our method to reconstruct arbitrary word sequences from semantic features (e.g., "May the Force be with you.").
- For a quick demo, see [./mcap_demo.ipynb](./mcap_demo.ipynb)ï¼Ž

### Analysis & evaluation
- To reproduce the main results in our manuscript, run the following script after activating the environment ('mcap_demo').
```plaintext
>> source activate mcap_demo
>> python mcap_analysis.py
>> python mcap_evaluation.py
```
- This analysis requires decoding results generated using our [MATLAB code](../matlab).
- You can download whole brain (generalization) decoding results from figshare without performing the analysis by yourself: <a href="https://doi.org/10.6084/m9.figshare.25808179">figshare</a>
 (<a href="https://figshare.com/ndownloader/files/46420294">decfeat_wb.zip</a>). After downloading, unzip the file and place it in the [MindCaptioning/res/decoding](../../res/decoding) directory.

- Using multiple GPUs is strongly recommended for the entire analysis, as the text generation analysis will take about 30 days to complete a single ROI analysis if using a single GPU.
- mcap_evaluation.py requies results generated by mcap_analysis.py.

- After completing the analysis, result figures can be generated using our [MATLAB code](../matlab). Please see [README.md](../matlab/README.md) in the directory.
- You can also download subsets of the results for drawing figures from <a href="https://doi.org/10.6084/m9.figshare.25808179">figshare</a> (<a href="https://figshare.com/ndownloader/files/46422523">res_textgen.zip</a>) without having to perform the analysis yourself.


### Note
- Although the script can run without a GPU, it will take an extremely long time for computation.
